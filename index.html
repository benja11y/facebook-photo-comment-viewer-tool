<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Facebook Photo Comment Viewer - Landing</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Facebook Photo Comment Viewer</h1>
  <section>
    <h2>Instructions</h2>
    <p>
      <!-- Placeholder for instructions -->
    </p>
  </section>
<section>
  <h2>Step 1: Get the Bookmarklet</h2>
  <div style="background:#fff3cd;border:1px solid #ffeeba;padding:1em;border-radius:4px;color:#856404;margin-bottom:1em;">
    <strong>Note:</strong> Facebook's Content Security Policy (CSP) may block bookmarklets that load external scripts.<br>
    If you see an error or nothing happens when using the bookmarklet, this is likely the cause.<br>
    <br>
    <b>Workaround:</b> This bookmarklet now embeds the code directly, which should bypass CSP issues.
  </div>
  <a href="javascript:(function(){&quot;use strict&quot;;function findCoreContainers(){console.log(&quot;--- Finding Core Containers ---&quot;),console.log(&quot;Searching for date permalink...&quot;);var complementaryElement=document.querySelector('div[role=&quot;complementary&quot;]');if(!complementaryElement)return console.error(&quot;Could not find the element with role='complementary'. Orientation failed.&quot;),null;console.log(&quot;Found complementary element:&quot;,complementaryElement);var e=Array.from(complementaryElement.querySelectorAll(&quot;a&quot;)).find(e=>e.href.includes(&quot;/photo/&quot;));if(!e)return console.error(&quot;Could not find the unique date permalink containing '/photo/' within the complementary element. Orientation failed.&quot;),null;console.log(&quot;Found date permalink element:&quot;,e),console.log(&quot;Searching for first comment article...&quot;);var t=document.querySelector('div[role=&quot;article&quot;]');if(!t)return console.error(&quot;Could not find any comment articles. Orientation failed.&quot;),null;console.log(&quot;Found first comment article:&quot;,t);var o=new Set,n=e.parentElement;for(;n;)o.add(n),n=n.parentElement;var r=null;for(n=t.parentElement;n;){if(o.has(n)){var l=Array.from(n.children).filter(e=>&quot;DIV&quot;===e.tagName);if(4===l.length){r=n;break}}n=n.parentElement}if(!r)return console.error(&quot;Could not find a common ancestor with 4 DIV children.&quot;),null;var l=Array.from(r.children).filter(e=>&quot;DIV&quot;===e.tagName);return{headerDiv:l[0],statsDiv:l[1],commentsDiv:l[3],datePermalink:e}}function scrapeMainPhoto(){console.log(&quot;Attempting to find the visible div[role='main'] containing the image...&quot;);var e=document.querySelectorAll('div[role=&quot;main&quot;]');if(0===e.length)return console.log(&quot;No div[role='main'] elements found.&quot;),&quot;PHOTO_URL_NOT_FOUND_NO_MAIN_DIV&quot;;var t='img[data-visualcompletion=&quot;media-vc-image&quot;]',o=null;for(let n=0;n<e.length;n++){let r=e[n];if(r.offsetHeight>0||r.clientHeight>0){console.log(`Checking visible div[role='main'] #${n+1}:`,r);let l=r.querySelector(t);if(l){o=l.src;console.log(&quot;Image found in visible div[role='main']:&quot;,l);break}}}if(!o)return console.log(&quot;Image not found in any visible div[role='main'] with selector:&quot;,t),&quot;PHOTO_URL_NOT_FOUND_NO_IMAGE_IN_VISIBLE_MAIN_DIV&quot;;return o}function scrapePostDate(e){if(!e)return&quot;DATE_NOT_FOUND&quot;;var t=Array.from(e.querySelectorAll(&quot;span&quot;)).filter(e=>1===e.textContent.trim().length);if(0===t.length)return e.textContent.trim()||&quot;DATE_NOT_FOUND&quot;;var o=t.map(e=>{var t=e.getBoundingClientRect();return{text:e.textContent,y:t.top,x:t.left}});o.sort((e,t)=>Math.abs(e.y-t.y)>5?e.y-t.y:e.x-t.x);if(o.length>0){var n=o[0].y;return o.filter(e=>Math.abs(e.y-n)<5).reduce((e,t,o,n)=>{const r=t.text;if(0===o)return r;const l=n[o-1].text;return/\d/.test(l)!==/\d/.test(r)?e+&quot; &quot;+r:e+r},&quot;&quot;)}return&quot;DATE_NOT_FOUND&quot;}function scrapePostAuthorAndMeta(e,t){if(!e)return{postAuthor:&quot;AUTHOR_NOT_FOUND&quot;,postLocation:&quot;LOCATION_NOT_FOUND&quot;};var o=e.querySelector(&quot;h2 a&quot;),n=o?o.textContent.trim():&quot;AUTHOR_NOT_FOUND&quot;,r=&quot;LOCATION_NOT_FOUND&quot;,l=Array.from(e.querySelectorAll(&quot;a&quot;)).find(e=>e!==o&&e!==t&&e.textContent.trim().length>0);return l&&(r=l.textContent.trim()),{postAuthor:n,postLocation:r}}function scrapeEngagement(e){var t={firstLiker:&quot;&quot;,otherCount:0},o=0;if(!e)return{likes:t,totalComments:o};var n=e.innerText,r=n.match(/\d+/g);r&&r.length>0&&(t.otherCount=parseInt(r[0],10)||0,r.length>1?o=parseInt(r[r.length-1],10)||0:/comment/i.test(e.innerText)&&(o=t.otherCount,t.otherCount=0));var l=e.querySelector('[aria-label*=&quot;See who reacted&quot;]');if(l){var s=l.innerText.trim();if(s){var a=s.match(/(.+) and ([\\d,]+) others?/);a?(t.firstLiker=a[1].trim(),t.otherCount=parseInt(a[2].replace(/,/g,&quot;&quot;),10)):/^\d+$/.test(s)||(t.firstLiker=s)}}return{likes:t,totalComments:o}}function scrapeCommentsAndAvatars(e,t){var o={};if(!e)return{comments:[],avatars:o};var n=e.querySelectorAll('div[role=&quot;article&quot;]'),r=document.querySelector(&quot;h2 a&quot;).closest(&quot;.x1cy8zhl&quot;).querySelector(&quot;image&quot;);r&&&quot;AUTHOR_NOT_FOUND&quot;!==t&&(o[t]=r.getAttribute(&quot;xlink:href&quot;));var l=Array.from(n).map(t=>{let n=0,r=t;for(;r&&r!==e;)n++,r=r.parentElement;var l=t.getAttribute(&quot;aria-label&quot;)||&quot;&quot;,s=l.match(/by (.*?)(?: to .*'s comment| \\d+)/),a=s?s[1].trim():null,i=t.querySelector('div[dir=&quot;auto&quot;]'),c=a&&i?i.innerText.trim():null,d=t.querySelector(&quot;image&quot;).getAttribute(&quot;xlink:href&quot;);return c?(d&&!o[a]&&(o[a]=d),{commentObject:{name:a,message:c},depth:n}):null}).filter(Boolean);if(0===l.length)return o.fallback=&quot;https://placehold.co/32x32/FFFFFF/000000?text=A&quot;,{comments:[],avatars:o};var s=[],a=[];return l.forEach(e=>{const{commentObject:t,depth:o}=e;for(;a.length>0&&o<=a[a.length-1].depth;)a.pop();a.length>0?(a[a.length-1].commentObject.replies||(a[a.length-1].commentObject.replies=[]),a[a.length-1].commentObject.replies.push(t)):s.push(t),a.push({commentObject:t,depth:o})}),(function e(t){t.forEach(t=>{t.replies&&t.replies.length>0?e(t.replies):delete t.replies})})(s),o.fallback=&quot;https://placehold.co/32x32/FFFFFF/000000?text=A&quot;,{comments:s,avatars:o}}function finalizeAndCopy(e){var t=JSON.stringify(e,null,2);document.execCommand('copy');alert(&quot;Facebook post data copied to clipboard!&quot;)}function runScraper(){try{console.log(&quot;--- Starting Facebook Page Scraper v7.2 ---&quot;);var e=findCoreContainers();if(!e)return void alert(&quot;Scraper could not orient itself on the page. Core containers not found. Check console.&quot;);var{headerDiv:t,statsDiv:o,commentsDiv:n,datePermalink:r}=e,{postAuthor:l,postLocation:s}=scrapePostAuthorAndMeta(t,r),a=scrapePostDate(r),{likes:i,totalComments:c}=scrapeEngagement(o),{comments:d,avatars:m}=scrapeCommentsAndAvatars(n,l),p=scrapeMainPhoto();finalizeAndCopy({mainPhotoUrl:p,postAuthor:l,postDate:a,postLocation:s,likes:i,totalComments:c,avatars:m,comments:d})}catch(e){console.error(&quot;The Facebook scraper bookmarklet failed to run:&quot;,e),alert(&quot;The scraper could not run successfully. Check the console for errors. The page structure may have changed.&quot;)}}runScraper();})();"
    id="bookmarklet-link"
    style="display:inline-block;padding:0.5em 1em;background:#e3e3e3;border-radius:4px;text-decoration:none;color:#222;font-weight:bold;cursor:grab;"
    draggable="true"
    title="Drag this to your bookmarks bar">
    Drag this to your bookmarks bar: Facebook Scraper
  </a>
  <p style="font-size:0.9em;margin-top:0.5em;">
    If you can't drag, right-click and "Bookmark Link" or copy the code below:
  </p>
  <textarea readonly rows="3" style="width:100%;font-size:0.9em;" onclick="this.select()">javascript:(function(){&quot;use strict&quot;;function findCoreContainers(){console.log(&quot;--- Finding Core Containers ---&quot;),console.log(&quot;Searching for date permalink...&quot;);var complementaryElement=document.querySelector('div[role=&quot;complementary&quot;]');if(!complementaryElement)return console.error(&quot;Could not find the element with role='complementary'. Orientation failed.&quot;),null;console.log(&quot;Found complementary element:&quot;,complementaryElement);var e=Array.from(complementaryElement.querySelectorAll(&quot;a&quot;)).find(e=>e.href.includes(&quot;/photo/&quot;));if(!e)return console.error(&quot;Could not find the unique date permalink containing '/photo/' within the complementary element. Orientation failed.&quot;),null;console.log(&quot;Found date permalink element:&quot;,e),console.log(&quot;Searching for first comment article...&quot;);var t=document.querySelector('div[role=&quot;article&quot;]');if(!t)return console.error(&quot;Could not find any comment articles. Orientation failed.&quot;),null;console.log(&quot;Found first comment article:&quot;,t);var o=new Set,n=e.parentElement;for(;n;)o.add(n),n=n.parentElement;var r=null;for(n=t.parentElement;n;){if(o.has(n)){var l=Array.from(n.children).filter(e=>&quot;DIV&quot;===e.tagName);if(4===l.length){r=n;break}}n=n.parentElement}if(!r)return console.error(&quot;Could not find a common ancestor with 4 DIV children.&quot;),null;var l=Array.from(r.children).filter(e=>&quot;DIV&quot;===e.tagName);return{headerDiv:l[0],statsDiv:l[1],commentsDiv:l[3],datePermalink:e}}function scrapeMainPhoto(){console.log(&quot;Attempting to find the visible div[role='main'] containing the image...&quot;);var e=document.querySelectorAll('div[role=&quot;main&quot;]');if(0===e.length)return console.log(&quot;No div[role='main'] elements found.&quot;),&quot;PHOTO_URL_NOT_FOUND_NO_MAIN_DIV&quot;;var t='img[data-visualcompletion=&quot;media-vc-image&quot;]',o=null;for(let n=0;n<e.length;n++){let r=e[n];if(r.offsetHeight>0||r.clientHeight>0){console.log(`Checking visible div[role='main'] #${n+1}:`,r);let l=r.querySelector(t);if(l){o=l.src;console.log(&quot;Image found in visible div[role='main']:&quot;,l);break}}}if(!o)return console.log(&quot;Image not found in any visible div[role='main'] with selector:&quot;,t),&quot;PHOTO_URL_NOT_FOUND_NO_IMAGE_IN_VISIBLE_MAIN_DIV&quot;;return o}function scrapePostDate(e){if(!e)return&quot;DATE_NOT_FOUND&quot;;var t=Array.from(e.querySelectorAll(&quot;span&quot;)).filter(e=>1===e.textContent.trim().length);if(0===t.length)return e.textContent.trim()||&quot;DATE_NOT_FOUND&quot;;var o=t.map(e=>{var t=e.getBoundingClientRect();return{text:e.textContent,y:t.top,x:t.left}});o.sort((e,t)=>Math.abs(e.y-t.y)>5?e.y-t.y:e.x-t.x);if(o.length>0){var n=o[0].y;return o.filter(e=>Math.abs(e.y-n)<5).reduce((e,t,o,n)=>{const r=t.text;if(0===o)return r;const l=n[o-1].text;return/\d/.test(l)!==/\d/.test(r)?e+&quot; &quot;+r:e+r},&quot;&quot;)}return&quot;DATE_NOT_FOUND&quot;}function scrapePostAuthorAndMeta(e,t){if(!e)return{postAuthor:&quot;AUTHOR_NOT_FOUND&quot;,postLocation:&quot;LOCATION_NOT_FOUND&quot;};var o=e.querySelector(&quot;h2 a&quot;),n=o?o.textContent.trim():&quot;AUTHOR_NOT_FOUND&quot;,r=&quot;LOCATION_NOT_FOUND&quot;,l=Array.from(e.querySelectorAll(&quot;a&quot;)).find(e=>e!==o&&e!==t&&e.textContent.trim().length>0);return l&&(r=l.textContent.trim()),{postAuthor:n,postLocation:r}}function scrapeEngagement(e){var t={firstLiker:&quot;&quot;,otherCount:0},o=0;if(!e)return{likes:t,totalComments:o};var n=e.innerText,r=n.match(/\d+/g);r&&r.length>0&&(t.otherCount=parseInt(r[0],10)||0,r.length>1?o=parseInt(r[r.length-1],10)||0:/comment/i.test(e.innerText)&&(o=t.otherCount,t.otherCount=0));var l=e.querySelector('[aria-label*=&quot;See who reacted&quot;]');if(l){var s=l.innerText.trim();if(s){var a=s.match(/(.+) and ([\\d,]+) others?/);a?(t.firstLiker=a[1].trim(),t.otherCount=parseInt(a[2].replace(/,/g,&quot;&quot;),10)):/^\d+$/.test(s)||(t.firstLiker=s)}}return{likes:t,totalComments:o}}function scrapeCommentsAndAvatars(e,t){var o={};if(!e)return{comments:[],avatars:o};var n=e.querySelectorAll('div[role=&quot;article&quot;]'),r=document.querySelector(&quot;h2 a&quot;).closest(&quot;.x1cy8zhl&quot;).querySelector(&quot;image&quot;);r&&&quot;AUTHOR_NOT_FOUND&quot;!==t&&(o[t]=r.getAttribute(&quot;xlink:href&quot;));var l=Array.from(n).map(t=>{let n=0,r=t;for(;r&&r!==e;)n++,r=r.parentElement;var l=t.getAttribute(&quot;aria-label&quot;)||&quot;&quot;,s=l.match(/by (.*?)(?: to .*'s comment| \\d+)/),a=s?s[1].trim():null,i=t.querySelector('div[dir=&quot;auto&quot;]'),c=a&&i?i.innerText.trim():null,d=t.querySelector(&quot;image&quot;).getAttribute(&quot;xlink:href&quot;);return c?(d&&!o[a]&&(o[a]=d),{commentObject:{name:a,message:c},depth:n}):null}).filter(Boolean);if(0===l.length)return o.fallback=&quot;https://placehold.co/32x32/FFFFFF/000000?text=A&quot;,{comments:[],avatars:o};var s=[],a=[];return l.forEach(e=>{const{commentObject:t,depth:o}=e;for(;a.length>0&&o<=a[a.length-1].depth;)a.pop();a.length>0?(a[a.length-1].commentObject.replies||(a[a.length-1].commentObject.replies=[]),a[a.length-1].commentObject.replies.push(t)):s.push(t),a.push({commentObject:t,depth:o})}),(function e(t){t.forEach(t=>{t.replies&&t.replies.length>0?e(t.replies):delete t.replies})})(s),o.fallback=&quot;https://placehold.co/32x32/FFFFFF/000000?text=A&quot;,{comments:s,avatars:o}}function finalizeAndCopy(e){var t=JSON.stringify(e,null,2);document.execCommand('copy');alert(&quot;Facebook post data copied to clipboard!&quot;)}function runScraper(){try{console.log(&quot;--- Starting Facebook Page Scraper v7.2 ---&quot;);var e=findCoreContainers();if(!e)return void alert(&quot;Scraper could not orient itself on the page. Core containers not found. Check console.&quot;);var{headerDiv:t,statsDiv:o,commentsDiv:n,datePermalink:r}=e,{postAuthor:l,postLocation:s}=scrapePostAuthorAndMeta(t,r),a=scrapePostDate(r),{likes:i,totalComments:c}=scrapeEngagement(o),{comments:d,avatars:m}=scrapeCommentsAndAvatars(n,l),p=scrapeMainPhoto();finalizeAndCopy({mainPhotoUrl:p,postAuthor:l,postDate:a,postLocation:s,likes:i,totalComments:c,avatars:m,comments:d})}catch(e){console.error(&quot;The Facebook scraper bookmarklet failed to run:&quot;,e),alert(&quot;The scraper could not run successfully. Check the console for errors. The page structure may have changed.&quot;)}}runScraper();})();</textarea>
</section>  <section>
    <h2>Step 2: Paste JSON Output</h2>
    <textarea id="json-input" rows="12" cols="80" placeholder="Paste JSON here"></textarea>
    <br>
    <button id="open-viewer-btn">Open Viewer</button>
  </section>
  <script>
    document.getElementById('open-viewer-btn').addEventListener('click', function() {
      const json = document.getElementById('json-input').value.trim();
      if (!json) {
        alert('Please paste the JSON output from the bookmarklet.');
        return;
      }
      try {
        JSON.parse(json);
      } catch (e) {
        alert('Invalid JSON. Please check your input.');
        return;
      }
      localStorage.setItem('fb_photo_comment_json', json);
      window.open('viewer.html', '_blank');
    });
  </script>
</body>
</html>
